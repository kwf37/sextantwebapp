<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <title>SEXTANT</title>

    <!-- Include jQuery Mobile stylesheets -->
    <link rel="stylesheet" type="text/css" href="/wristApp/jquery-mobile/jquery.mobile.min.css">
	<link rel="stylesheet" type="text/css" href="/wristApp/font-awesome/css/font-awesome.min.css">
</head>
<body>


    <style>

    html, body, #cesiumContainer {
          width: 100vw; 
          /* Apparently you need spaces around the - sign for calc() to work (https://stackoverflow.com/questions/30412580/why-is-css-calc100-250px-not-working)- quite frustrating*/
          height: calc(100vh - 50px); 
          overflow: hidden;
          position:fixed;
          top:0px;
      }
    
    #containerConnected_div {
        position: absolute;
        top:80px;
        right:80px;
        /*width:30px;
        height:15px;*/
        background-color:white;
        z-index:2;
        //border:1px solid black;
        border-radius:12px;
    }

    .saveDialog{
        position: absolute;
        z-index:2;
        width:200px;
        height:auto;
        display: none;      
        top: 50%;
        left: 50%;
        margin: -100px 0 0 -150px;
        background-color:white;
        border:2px solid black;
        border-radius:5px;
        padding:10px;
    }

    #connectedDevices{
        position: fixed;
        top:50px;
        left:30px;
        width:auto;
        height:auto;
        z-index:2;
        background: rgba(255, 255, 255, 0.5);
    }

    /*Hide silly looking follow checkbox*/
    #follow_checkbox, #follow_label input {display:none;}

    #savePopup{
        position: fixed;
        top: 50px;
        left: 200px;
        width: 250px;
        height:auto;
        z-index: 5;
        display:none; 
        background:white;
        border-radius: 5px;
        box-shadow: 0 10px 10px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }
    #savePopup tr:nth-child(odd) {
    background-color: #eee;
    }
    #savePopup th, td {
    padding: 5px;
    }

    /* Handles Mobile Phone Scrollbars- Left it in as it may prove useful if we add more features*/

    /* !important is needed sometimes */
    ::-webkit-scrollbar {
        width: 12px !important;
    }

    /* Track */
    ::-webkit-scrollbar-track {
       -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3) !important;
       -webkit-border-radius: 10px !important;
       border-radius: 10px !important;
   }

   /* Handle */
   ::-webkit-scrollbar-thumb {
    -webkit-border-radius: 10px !important;
    border-radius: 10px !important;
    background: #41617D !important; 
    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5) !important; 

    }
    ::-webkit-scrollbar-thumb:window-inactive {
    background: #41617D !important; 
    }
</style>

<!-- Popup when you hit SavePlan soft TODO, as it should be formatted to look better.
On phones, when virtual keyboard is being used, it may cover the text field. 

<div id="savePopup"  class="saveDialog">
    <form id="myForm">
      <div class="ui-field-contain">
        <label for="planName">Save as:</label>
        <input type="text" name="planName" id="planName" placeholder="New Plan Name" data-clear-btn="true">
    <input type="submit" value="Save" id="submitForm">
    <input type="button" value="Cancel" id="cancel" style="display:inline;">
    </div>
</form>
</div> -->

<!-- Same html from xgds server -->
<div id="savePopup">
        <p>Enter a new name and/or version to save as.  (Version already changed.)</p>
        <table>
        <tr>
            <td><label for="saveAsName">Name</label></td>
            <td><input type="text" id="saveAsName"></td>
        </tr>
        <tr>
            <td><label for="saveAsVersion">Version</label></td>
            <td><input type="text" id="saveAsVersion"></td>
        </tr>
        <tr>
            <td><label for="saveAsNotes">Notes</label></td>
            <td><input type="text" id="saveAsNotes"></td>
        </tr>
        <tr></tr>
        </table>
        <div data-role="controlgroup" data-type="horizontal">
            <a href="#" class="ui-btn" onclick="$('#savePopup').toggle();"> Cancel</a>
            <a href="#" class="ui-btn" onclick="handleSave();">Save</a>
        </div>
</div>


<!-- Symbol that shows whether we're connected to container in top right of screen -->
<div id="containerConnected_div">   
    <span class="btn alert-danger" id="connected_div" style="visibility: visible;">
        <span class="fa" id="connected" style="min-width:1rem;">
        </span>
    </span>
</div>

<div id = connectedDevices> <!-- TODO Added by Kenneth- list content is loaded from config-->
    <ul id = deviceList style="list-style-type:none; margin:5px; padding:0;">
    </ul>
</div>

<!-- Text Displayed in top left during regular viewing- -->
<div class="editModeText" id="viewMode">   
    <span style="color:red" class="planNameSpan"></span>
</div>

<!-- Text Displayed in top left while editing- TODO -->
<div class="editModeText" id="editMode" style="display:none;">   
    <span style="color:red">EDITING &nbsp;<span class="planNameSpan"></span></span>
</div>


<div id="cesiumContainer"></div>
<div id="credits" style="display:none;"></div>
<div id="hovercoord" style="display:none;"></div>



<!-- Regular Mode toolbar -->
<div data-role="footer" data-position="fixed" data-tap-toggle="false" style="text-align:center;" id="viewModeToolbar">
  <div data-role="controlgroup" data-type="horizontal">
    <a href="#" class="ui-btn" onclick="reloadPlan();">Reload Plan</a>
    <a href="#" class="ui-btn" onclick="clearTracks();">Clear Track</a>
    <!-- Calls toggleEdit from sextant_caller and switches toolbars-->
    <a href="#" class="ui-btn" onclick="followPosition(false); toggleEditMode(); toggleMode();">Edit Plan</a>
    <!--  <a href="#" class="ui-btn" onclick="zoomToPosition();">Zoom to Position</a>  -->
    <a href="#" class="ui-btn" onclick="zoomToPlan();">Zoom to Plan</a>
    <a href="#" class="ui-btn" onclick="reOrient();">ReOrient</a>

    <label id="follow_label"><input type="checkbox" onclick="followPosition(event.target.checked)" checked id="follow_checkbox"></input> Follow</label> 
  </div>
</div>

<!-- Edit Mode toolbar -->
<div data-role="footer" data-position="fixed" data-tap-toggle="false" style="text-align:center; display:none;" id="editModeToolbar">
  <div data-role="controlgroup" data-type="horizontal" id="editControl">
    <a href="#" class="ui-btn" onclick="sendPlanToSextant()">Calculate Path</a>
    <a href="#" class="ui-btn" onclick="reloadPlan();">Reload Plan</a>
    <a href="#" class="ui-btn" onclick="clearTracks()">Clear Track</a>
    <a href="#" class="ui-btn" onclick="$('#savePopup').toggle();">Save Plan</a>
    <!-- Calls toggleEdit from sextant_caller and switches toolbars-->
    <a href="#" class="ui-btn" onclick="toggleEditMode(); toggleMode(); followPosition($('#follow_checkbox').prop('checked'));">Done Editing</a>
  </div>
</div>


<script src="/wristApp/jquery/jquery.min.js"></script>
<script src="/wristApp/jquery-mobile/jquery.mobile.min.js"></script>
<script src="./build/sextant.bundle.js"></script>
<script src="./sextant_caller.js"></script>

<!-- jQuery scripts for handling saving path. Currently does nothing, but can be altered to send http POST request to xgds server -->
    <script>
        $(document).ready(function(){
            loadDevices();
            setInterval(function(){checkConnectedDevices();},1000);
        });
        //Helper method used to toggle between views
        function toggleMode(){
             $('#viewModeToolbar').toggle(); 
             $('#editModeToolbar').toggle();
             $('.editModeText').toggle();
        }

        function handleSave(){ //TODO rather redundant
            let info=savePlan($('#saveAsName').val(),$('#saveAsVersion').val(),$('#saveAsNotes').val());
            console.log(info);
        }

    </script>
</body>
</html>
